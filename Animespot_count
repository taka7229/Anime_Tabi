PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX schema: <http://schema.org/>
PREFIX dbo: <http://dbpedia.org/ontology/>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT 
(?anime_titlel AS ?アニメ名)
(?prefecture AS ?都道府県)
(STR(COUNT(DISTINCT ?spot)) as ?spot_count)

WHERE {
  # アニメのタイトルを取得
  ?anime rdfs:label ?anime_title .
 
  # 聖地スポットを取得
  ?spot schema:about ?anime ;
    	schema:category "聖地" ;
    	dbo:location ?location .
 
  
  ?location dbo:region ?prefectureEntity .
 
  # 都道府県名を取得
  ?prefectureEntity rdfs:label ?prefecture .
 
  # アニメ名で部分一致フィルター
  FILTER(CONTAINS(LCASE(str(?anime_title)), LCASE("けいおん")))
}
GROUP BY ?anime_title ?prefecture
ORDER BY ?anime_title ?prefecture
